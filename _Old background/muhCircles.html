<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="FileSaver.js"></script>
<script type="text/javascript" src="canvas-toBlob.js"></script>
<script type="text/javascript">
var circles=[];
function Circle(x,y,r,l,c,animV,phase){
	this.x=x;
	this.y=y;
	this.r=r;
	this.l=l;
	this.c=c;
	this.animV=animV;
	this.phase=phase%Math.PI*2;
}

var CIRCLES_PER_STRAND=200;
var L_COLOR_H=221, L_COLOR_S=81, L_COLOR_L=50;
var R_COLOR_H=263, R_COLOR_S=81, R_COLOR_L=50;
var COLOR_H_VARIANCE=10, COLOR_S_VARIANCE=5, COLOR_L_VARIANCE=0;
var MIN_Z=0.01, MAX_Z=2;
var X_OFF_L=-0.3, X_OFF_R=0.3, Y_OFF_L=0.5, Y_OFF_R=0.51;
var X_VARIANCE=0.04, Y_VARIANCE=0.04;
var RADIUS=0.35, RADIUS_VARIANCE=0.07;
var LINE_WIDTH=0.007;
var X_ANIM_VARIANCE=0.02, Y_ANIM_VARIANCE=0.02;
var BACKGROUND1_H=0, BACKGROUND1_S=0, BACKGROUND1_L=0;
var BACKGROUND2_H=243, BACKGROUND2_S=81, BACKGROUND2_L=20;
var ANIM_SPEED_MIN=1, ANIM_SPEED_MAX=1, ANIM_FREQUENCY=0;
var CENTER_X=0.5, CENTER_Y=0;
var INTERVAL=50;

function initCircles(){
	var z=MIN_Z, zStep=(MAX_Z-MIN_Z)/CIRCLES_PER_STRAND;
	for(var i=0;i<CIRCLES_PER_STRAND;i++){
		circles.push(new Circle(CENTER_X+z*(X_OFF_L+Math.random()*X_VARIANCE-X_VARIANCE/2),CENTER_Y+z*(Y_OFF_L+Math.random()*Y_VARIANCE-Y_VARIANCE/2),z*(RADIUS+Math.random()*RADIUS_VARIANCE-RADIUS_VARIANCE/2),LINE_WIDTH*z, 'hsl('+(L_COLOR_H+Math.random()*COLOR_H_VARIANCE-COLOR_H_VARIANCE/2)+','+(L_COLOR_S+Math.random()*COLOR_S_VARIANCE-COLOR_S_VARIANCE/2)+'%,'+(z*(L_COLOR_L+Math.random()*COLOR_L_VARIANCE-COLOR_L_VARIANCE/2))+'%)',z,z*2));
		z+=zStep/2;
		circles.push(new Circle(CENTER_X+z*(X_OFF_R+Math.random()*X_VARIANCE-X_VARIANCE/2),CENTER_Y+z*(Y_OFF_R+Math.random()*Y_VARIANCE-Y_VARIANCE/2),z*(RADIUS+Math.random()*RADIUS_VARIANCE-RADIUS_VARIANCE/2),LINE_WIDTH*z, 'hsl('+(R_COLOR_H+Math.random()*COLOR_H_VARIANCE-COLOR_H_VARIANCE/2)+','+(R_COLOR_S+Math.random()*COLOR_S_VARIANCE-COLOR_S_VARIANCE/2)+'%,'+(z*(R_COLOR_L+Math.random()*COLOR_L_VARIANCE-COLOR_L_VARIANCE/2))+'%)',z,1+z*2));
		z+=zStep/2;
	}
	setInterval(function(){
		for(var i=0;i<circles.length;i++){
			var anim_speed=(Math.sin(((Date.now() / 1000.0)*Math.PI*2)*ANIM_FREQUENCY)*0.5+0.5)*(ANIM_SPEED_MAX-ANIM_SPEED_MIN)+ANIM_SPEED_MIN;
			circles[i].phase=(circles[i].phase+(0.00025*INTERVAL)*anim_speed)%(Math.PI*2);
			
		}
	},INTERVAL);
	setInterval(function(){drawCanvas();},INTERVAL);
}

function drawCanvas(){
	var canvas=document.getElementById("canvas");
	var w=canvas.width, h=canvas.height;
	var ctx=canvas.getContext("2d");
	var gradient=ctx.createLinearGradient(0,0,0,canvas.height);
	gradient.addColorStop(0,"hsl("+BACKGROUND1_H+","+BACKGROUND1_S+"%,"+BACKGROUND1_L+"%)");
	gradient.addColorStop(1,"hsl("+BACKGROUND2_H+","+BACKGROUND2_S+"%,"+BACKGROUND2_L+"%)");
	ctx.fillStyle=gradient;
	ctx.fillRect(0,0,canvas.width,canvas.height);
	for(var i=0;i<circles.length;i++){
		var c=circles[i];
		ctx.beginPath();
		ctx.arc((c.x+(Math.cos(c.phase)*c.animV*X_ANIM_VARIANCE))*w,(c.y+(Math.sin(c.phase)*c.animV*Y_ANIM_VARIANCE))*(w/h>1?w:h),c.r*w,0,2*Math.PI,false);
		ctx.strokeStyle=c.c;
		ctx.lineWidth=c.l*w;
		ctx.stroke();
	}
}
var UBERSAMPLING=1;
function initCanvas(){
	var canvas=document.getElementById("canvas");
	canvas.width=canvas.clientWidth*UBERSAMPLING;
	canvas.height=canvas.clientHeight*UBERSAMPLING;
	var ctx=canvas.getContext("2d");
	drawCanvas();
}
function setUberSampling(u){
	UBERSAMPLING=u;
	initCanvas();
}

function toFile(width,height){
	if(!width||!height){
		width=screen.width;
		height=screen.height;
	}
	var canvas=document.getElementById("canvas");
	canvas.width=width;
	canvas.height=height;
	drawCanvas();
	canvas.toBlob(function(blob){saveAs(blob,"muhCircles.png")},"image/png");
	initCanvas();
	drawCanvas();
}


function init(){
	try{
		var q=document.location.search.substring(1).split(",");
		if(q.length==35){
			CIRCLES_PER_STRAND=Number(q[0]);
			L_COLOR_H=Number(q[1]);
			L_COLOR_S=Number(q[2]);
			L_COLOR_L=Number(q[3]);
			R_COLOR_H=Number(q[4]);
			R_COLOR_S=Number(q[5]);
			R_COLOR_L=Number(q[6]);
			COLOR_H_VARIANCE=Number(q[7]);
			COLOR_S_VARIANCE=Number(q[8]);
			COLOR_L_VARIANCE=Number(q[9]);
			MIN_Z=Number(q[10]);
			MAX_Z=Number(q[11]);
			X_OFF_L=Number(q[12]);
			X_OFF_R=Number(q[13]);
			Y_OFF_L=Number(q[14]);
			Y_OFF_R=Number(q[15]);
			X_VARIANCE=Number(q[16]);
			Y_VARIANCE=Number(q[17]);
			RADIUS=Number(q[18]);
			RADIUS_VARIANCE=Number(q[19]);
			LINE_WIDTH=Number(q[20]);
			X_ANIM_VARIANCE=Number(q[21]);
			Y_ANIM_VARIANCE=Number(q[22]);
			BACKGROUND1_H=Number(q[23]);
			BACKGROUND1_S=Number(q[24]);
			BACKGROUND1_L=Number(q[25]);
			BACKGROUND2_H=Number(q[26]);
			BACKGROUND2_S=Number(q[27]);
			BACKGROUND2_L=Number(q[28]);
			ANIM_SPEED_MIN=Number(q[29]);
			ANIM_SPEED_MAX=Number(q[30]);
			ANIM_FREQUENCY=Number(q[31]);
			CENTER_X=Number(q[32]);
			CENTER_Y=Number(q[33]);
			INTERVAL=Number(q[34]);
		}
	}catch(e){
	}
	initCircles();
	initCanvas();
}

</script>
</head>
<body onResize="initCanvas()" onLoad="init()" style="background-color:#000000">
<canvas id="canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; border:none; margin:0; padding:0;"></canvas>
</body>
</html>